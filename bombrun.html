<!DOCTYPE html>
<html lang="en">
  <head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

      // Load the Visualization API and the line chart package.
      google.charts.load('current', {'packages':['line']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(drawChart);

      function getBombData() {
	var bombRun = [];
	for ( let i = 0; i < 25; i++ ) {
		bombRun.push( parseFloat( document.getElementById("b"+i).value ));
	}
 	return bombRun;
      }

      function getHitsData() {
	var regHits = [];
	for ( let i = 0; i < 15; i++ ) {
		regHits.push( parseFloat( document.getElementById("h"+i).value ));
	}
	return regHits;
      }

      function calculateAverageData() {
	var data = calculateData();
	for ( let i = 0; i < 9999; i++ ) {
	  var d0 = calculateData();
	  for ( let j = 0; j < data.length; j++ ) {
	    for ( let k = 0; k < data[j].length; k++ ) {
              data[j][k] = data[j][k] + d0[j][k];
	    }
	  }
	}
	for ( let j = 0; j < data.length; j++ ) {
	  for ( let k = 0; k < data[j].length; k++ ) {
	    data[j][k] = data[j][k] / 10000.0;
	  }
	}
	return data;
      }

      function calculateData() {
	var bombRun = getBombData();
	var regHits = getHitsData();
 	var allHits = getBombData().concat( getHitsData() );

	var b2 = Math.min( parseInt( document.getElementById("pick2").value ), bombRun.length );
	var b1 = Math.min( parseInt( document.getElementById("pick1").value ), bombRun.length - b2);
	var b0 = Math.max( 0, bombRun.length - b2 - b1 );
	document.getElementById("pick0").value = b0;

	var floors = 60;
	var totalHits = regHits.length + bombRun.length + floors;

	var data = [];

	for ( let i = totalHits; i > 0; i-- ) {
	  var vals = [
		  totalHits - i,
		  calculateEv( bombRun, regHits, b2, b1, b0, floors ),
	  	  calculateEv( [], allHits, 0, 0, 0, floors )];
	  data.push( vals );
	  var hit = getRandomHit(i);
	  allHits.splice( hit, 1 );
	  if ( hit < regHits.length ) {
            regHits.splice( hit, 1 );
	  } else if ( hit < regHits.length + b0 ) {
            b0 -= 1;
	    removeBoom( bombRun, 0 );
	  } else if ( hit < regHits.length + b0 + b1 ) {
	    b1 -= 1;
	    removeBoom( bombRun, 1 );
	  } else if ( hit < regHits.length + b0 + b1 + b2 ) {
	    b2 -= 1;
	    removeBoom( bombRun, 2 );
	  } else {
	    floors--;
	  }
	}

        return data;
      }

      function removeBoom ( bombRun, pick ) {
	var removeMe = boomEv( bombRun, pick );
	if ( removeMe > 0 ) {
          if ( bombRun[0] == removeMe ) {
	    bombRun.splice( 0, 1 );
	  } else if ( bombRun[1] == removeMe ) {
	    bombRun.splice( 1, 1 );
	  } else {
	    bombRun.splice( 2, 1 );
	  }
	}
      }

      function getRandomHit(max) {
        return Math.floor(Math.random() * max);
      }

      function calculateEv ( bombRun, regHits, b2, b1, b0, floors ) {
	var tot = 0;
	for ( let i = 0; i < regHits.length; i++ ) {
	  tot += regHits[i];
	}
	tot += boomEv( bombRun, 2 ) * b2;
	tot += boomEv( bombRun, 1 ) * b1;
	tot += boomEv( bombRun, 0 ) * b0;
	tot += floorValue() * floors;
	return tot / (regHits.length + bombRun.length + floors);
      }

      function floorValue () {
	return parseInt( document.getElementById("miss").value );
      }

      function boomEv ( bombRun, pick ) {
	if ( bombRun.length == 0 ) {
	  return 0;
	} else if ( bombRun.length == 1 || pick == 0 ) {
	  return bombRun[0];
	} else if ( bombRun.length == 2 || pick == 1 ) {
	  return Math.max( bombRun[0], bombRun[1] );
	} else {
	  return Math.max( bombRun[0], bombRun[1], bombRun[2] );
	}
      }

      // Callback that creates and populates a data table. 
      function drawChart() {
	var data = new google.visualization.DataTable();
      	data.addColumn('number', 'Hit Number');
      	data.addColumn('number', 'Bombrun EV');
	data.addColumn('number', 'Standard EV');

      	data.addRows( calculateData() );

        // Set chart options
        var options = {
          chart: {
            title: 'Single Random Run Hit EV',
            subtitle: 'in USD'
          },
          width: 900,
          height: 500
        };

        var chart = new google.charts.Line(document.getElementById('bombrun_ev_div'));
        chart.draw(data, google.charts.Line.convertOptions(options));

	var avgData = new google.visualization.DataTable();
      	avgData.addColumn('number', 'Hit Number');
      	avgData.addColumn('number', 'Bombrun EV');
	avgData.addColumn('number', 'Standard EV');

      	avgData.addRows( calculateAverageData() );

        // Set chart options
        var avgOptions = {
          chart: {
            title: 'Average 10,000 Runs EV',
            subtitle: 'in USD'
          },
          width: 900,
          height: 500
        };

        var avgChart = new google.charts.Line(document.getElementById('multirun_ev_div'));
        avgChart.draw(avgData, google.charts.Line.convertOptions(avgOptions));

    }
    </script>
  </head>

  <body>
	  <h1>Bomb Run</h1>
    <div id="bombrun_div">
	    <table id="monkey_arms">
		    <tr>
			    <td>Regular</td><td><input type="text" id="pick0" value="13"/></td>
		    </tr>
		    <tr>
			    <td>Long</td><td><input type="text" id="pick1" value="8"/></td>
		    </tr>
		    <tr>
			    <td>Extra Long</td><td><input type="text" id="pick2" value="4"/></td>
		    </tr>
	    </table>
	    <table id="bombrun">
		    <tr>
			    <td><input id="b0" type="text" value="25"/></td>
			    <td><input id="b1" type="text" value="25"/></td>
			    <td><input id="b2" type="text" value="25"/></td>
			    <td><input id="b3" type="text" value="25"/></td>
			    <td><input id="b4" type="text" value="25"/></td>
		    </tr>
		    <tr>
                            <td><input id="b5" type="text" value="25"/></td>
                            <td><input id="b6" type="text" value="25"/></td>
                            <td><input id="b7" type="text" value="25"/></td>
                            <td><input id="b8" type="text" value="25"/></td>
			    <td><input id="b9" type="text" value="25"/></td>
		    </tr>

		    <tr>
			    <td><input id="b10" type="text" value="25"/></td>
			    <td><input id="b11" type="text" value="25"/></td>
			    <td><input id="b12" type="text" value="25"/></td>
			    <td><input id="b13" type="text" value="25"/></td>
			    <td><input id="b14" type="text" value="25"/></td>
		    </tr>

		    <tr>
			    <td><input id="b15" type="text" value="25"/></td>
			    <td><input id="b16" type="text" value="25"/></td>
			    <td><input id="b17" type="text" value="25"/></td>
			    <td><input id="b18" type="text" value="25"/></td>
			    <td><input id="b19" type="text" value="25"/></td>
		    </tr>

		    <tr>
			    <td><input id="b20" type="text" value="25"/></td>
			    <td><input id="b21" type="text" value="25"/></td>
			    <td><input id="b22" type="text" value="25"/></td>
			    <td><input id="b23" type="text" value="25"/></td>
			    <td><input id="b24" type="text" value="150"/></td>
		    </tr>
	    </table>
    </div>

    <h1>Hits</h1>
    <div id="hits_div">
	    <table id="hits">
		    <tr>
			    <td><input id="h0" type="text" value="25"/></td>
			    <td><input id="h1" type="text" value="25"/></td>
			    <td><input id="h2" type="text" value="25"/></td>
			    <td><input id="h3" type="text" value="25"/></td>
			    <td><input id="h4" type="text" value="25"/></td>
		    </tr>
		    <tr>
			    <td><input id="h5" type="text" value="25"/></td>
			    <td><input id="h6" type="text" value="25"/></td>
			    <td><input id="h7" type="text" value="25"/></td>
			    <td><input id="h8" type="text" value="25"/></td>
			    <td><input id="h9" type="text" value="25"/></td>
		    </tr>
		    <tr>
			    <td><input id="h10" type="text" value="25"/></td>
			    <td><input id="h11" type="text" value="25"/></td>
			    <td><input id="h12" type="text" value="25"/></td>
			    <td><input id="h13" type="text" value="25"/></td>
			    <td><input id="h14" type="text" value="25"/></td>
		    </tr>
	    </table>
    </div>
    <div>
	    <h1>60 Floors</h1>
	    <input id="miss" type="text" value="5"/>
    </div>
    <div><input type="button" value="Calculate" onClick="drawChart();" /></div>
    <br/>

<!--Div that will hold the pie chart-->
    <div id="bombrun_ev_div" style="width:900; height:500"></div>
    <div id="multirun_ev_div" style="width:900; height:500"></div>
  </body>
</html>
